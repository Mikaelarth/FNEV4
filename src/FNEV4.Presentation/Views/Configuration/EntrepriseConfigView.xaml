<UserControl x:Class="FNEV4.Presentation.Views.Configuration.EntrepriseConfigView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    
    <UserControl.Resources>
        <!-- Convertisseurs -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        
        <!-- Animations -->
        <Storyboard x:Key="FadeInAnimation">
            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.5"/>
        </Storyboard>
        
        <Storyboard x:Key="SlideInAnimation">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)" 
                           From="20" To="0" Duration="0:0:0.3"/>
        </Storyboard>
        
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock" BasedOn="{StaticResource MaterialDesignHeadline6TextBlock}">
            <Setter Property="Margin" Value="0,0,0,15"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryHueMidBrush}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
        
        <Style x:Key="FieldLabelStyle" TargetType="TextBlock" BasedOn="{StaticResource MaterialDesignBody1TextBlock}">
            <Setter Property="Margin" Value="0,15,0,5"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBody}"/>
        </Style>

        <Style x:Key="InfoCardStyle" TargetType="materialDesign:Card">
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="materialDesign:ShadowAssist.ShadowDepth" Value="Depth2"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <TranslateTransform/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <EventTrigger RoutedEvent="Loaded">
                    <BeginStoryboard Storyboard="{StaticResource SlideInAnimation}"/>
                </EventTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SubCardStyle" TargetType="materialDesign:Card">
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
            <Setter Property="materialDesign:ShadowAssist.ShadowDepth" Value="Depth1"/>
            <Setter Property="Background" Value="{DynamicResource MaterialDesignCardBackground}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="materialDesign:ShadowAssist.ShadowDepth" Value="Depth3"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style pour les champs avec validation en temps rÃ©el -->
        <Style x:Key="ValidatedTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=(Validation.HasError), RelativeSource={RelativeSource Self}}" Value="True">
                    <Setter Property="BorderBrush" Value="Red"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Path=(Validation.HasError), RelativeSource={RelativeSource Self}}" Value="False">
                    <Setter Property="BorderBrush" Value="Green"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Style pour les boutons avec animations -->
        <Style x:Key="AnimatedButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Setter.Value>
            </Setter>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" 
                                               To="1.05" Duration="0:0:0.1"/>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" 
                                               To="1.05" Duration="0:0:0.1"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                    <Trigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" 
                                               To="1" Duration="0:0:0.1"/>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" 
                                               To="1" Duration="0:0:0.1"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.ExitActions>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- En-tÃªte moderne avec icÃ´ne -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <materialDesign:PackIcon Grid.Column="0" 
                                   Kind="Domain" 
                                   Width="32" Height="32"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource PrimaryHueMidBrush}"/>
            
            <StackPanel Grid.Column="1" Margin="16,0,0,0" VerticalAlignment="Center">
                <TextBlock Text="Configuration Entreprise" 
                         FontSize="24" 
                         FontWeight="Bold"
                         Foreground="{DynamicResource MaterialDesignBody}"/>
                <TextBlock Text="Configurez les informations de votre entreprise pour la certification FNE" 
                         FontSize="14" 
                         Foreground="{DynamicResource MaterialDesignBodyLight}"
                         Margin="0,4,0,0"/>
            </StackPanel>
            
            <Button Grid.Column="2" 
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    VerticalAlignment="Center"
                    Command="{Binding ResetCommand}">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Refresh" Width="16" Height="16" Margin="0,0,8,0"/>
                    <TextBlock Text="RÃ©initialiser"/>
                </StackPanel>
            </Button>
        </Grid>

        <!-- Statut Configuration avec indicateur de progression -->
        <materialDesign:Card Grid.Row="1" Margin="0,0,0,16" Padding="20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Ligne de statut -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                    <Border CornerRadius="20" 
                            Width="12" Height="12"
                            Margin="0,0,12,0"
                            VerticalAlignment="Center"
                            Background="{Binding StatusColor}"/>
                    <materialDesign:PackIcon Kind="{Binding StatusIcon}" 
                                           Width="24" Height="24"
                                           VerticalAlignment="Center" 
                                           Margin="0,0,12,0"
                                           Foreground="{Binding StatusColor}"/>
                    <TextBlock Text="{Binding StatusMessage}" 
                             VerticalAlignment="Center"
                             Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                             FontWeight="Medium"/>
                    
                    <TextBlock Text="{Binding CompletionPercentage, StringFormat='({0}% complet)'}" 
                             VerticalAlignment="Center"
                             Style="{StaticResource MaterialDesignBody2TextBlock}"
                             Foreground="{DynamicResource MaterialDesignBodyLight}"
                             Margin="12,0,0,0"/>
                </StackPanel>
                
                <!-- Barre de progression -->
                <ProgressBar Grid.Row="1" 
                           Value="{Binding CompletionPercentage}" 
                           Maximum="100"
                           Height="6"
                           Background="{DynamicResource MaterialDesignDivider}"
                           Foreground="{DynamicResource PrimaryHueMidBrush}"
                           materialDesign:TransitionAssist.DisableTransitions="False"/>
            </Grid>
        </materialDesign:Card>

        <!-- Contenu principal avec scroll -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="4"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Colonne Gauche : Informations Entreprise -->
                <materialDesign:Card Grid.Column="0" Style="{StaticResource InfoCardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                            <materialDesign:PackIcon Kind="OfficeBuilding" 
                                                   Width="24" Height="24"
                                                   VerticalAlignment="Center" 
                                                   Margin="0,0,12,0" 
                                                   Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                            <TextBlock Text="Informations Entreprise" 
                                     Style="{StaticResource SectionHeaderStyle}"
                                     Margin="0"/>
                        </StackPanel>
                        
                        <!-- NCC Entreprise avec validation avancÃ©e -->
                        <Grid Margin="0,0,0,24">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="NCC Entreprise" Style="{StaticResource FieldLabelStyle}" Margin="0"/>
                                    <TextBlock Text="*" Foreground="Red" FontWeight="Bold" Margin="4,0,0,0"/>
                                    <materialDesign:PackIcon Kind="HelpCircle" 
                                                           Width="16" Height="16" 
                                                           Margin="8,0,0,0"
                                                           Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                           ToolTip="Format requis: 7 chiffres suivis d'une lettre (ex: 9606123E)"/>
                                </StackPanel>
                                <TextBox Text="{Binding CompanyNcc, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"
                                         materialDesign:HintAssist.Hint="Ex: 9606123E"
                                         materialDesign:TextFieldAssist.CharacterCounterVisibility="Visible"
                                         MaxLength="8"
                                         FontFamily="Consolas"
                                         FontSize="14"
                                         Style="{StaticResource ValidatedTextBoxStyle}">
                                    <TextBox.InputBindings>
                                        <KeyBinding Key="Enter" Command="{Binding ValidateNccCommand}"/>
                                    </TextBox.InputBindings>
                                </TextBox>
                                <TextBlock Text="{Binding NccValidationMessage}" 
                                         Foreground="{Binding NccValidationColor}"
                                         FontSize="12"
                                         Margin="0,4,0,0"
                                         Visibility="{Binding HasNccValidationMessage, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                            </StackPanel>
                            
                            <!-- Indicateur de validation -->
                            <materialDesign:PackIcon Grid.Column="1" 
                                                   Kind="CheckCircle" 
                                                   Width="28" Height="28"
                                                   VerticalAlignment="Bottom" 
                                                   Margin="12,0,0,16"
                                                   Foreground="Green"
                                                   Visibility="{Binding IsNccValid, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <materialDesign:PackIcon.RenderTransform>
                                    <ScaleTransform ScaleX="0" ScaleY="0"/>
                                </materialDesign:PackIcon.RenderTransform>
                                <materialDesign:PackIcon.Style>
                                    <Style TargetType="materialDesign:PackIcon">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsNccValid}" Value="True">
                                                <DataTrigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" 
                                                                           To="1" Duration="0:0:0.3"/>
                                                            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" 
                                                                           To="1" Duration="0:0:0.3"/>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.EnterActions>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </materialDesign:PackIcon.Style>
                            </materialDesign:PackIcon>
                            
                            <!-- Bouton de vÃ©rification NCC -->
                            <Button Grid.Column="2"
                                    Style="{StaticResource MaterialDesignIconButton}"
                                    Command="{Binding VerifyNccCommand}"
                                    ToolTip="VÃ©rifier le NCC dans la base DGI"
                                    VerticalAlignment="Bottom"
                                    Margin="8,0,0,8">
                                <materialDesign:PackIcon Kind="CloudSearch" Width="20" Height="20"/>
                            </Button>
                        </Grid>

                        <!-- Nom Entreprise avec suggestions -->
                        <StackPanel Margin="0,0,0,24">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Nom de l'entreprise" Style="{StaticResource FieldLabelStyle}" Margin="0"/>
                                <TextBlock Text="*" Foreground="Red" FontWeight="Bold" Margin="4,0,0,0"/>
                            </StackPanel>
                            <ComboBox IsEditable="True"
                                      Text="{Binding CompanyName, UpdateSourceTrigger=PropertyChanged}"
                                      ItemsSource="{Binding CompanyNameSuggestions}"
                                      materialDesign:HintAssist.Hint="Ex: SARL FNEV4"
                                      Style="{StaticResource MaterialDesignOutlinedComboBox}"/>
                        </StackPanel>
                        
                        <!-- Adresse avec gÃ©olocalisation -->
                        <StackPanel Margin="0,0,0,24">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="Adresse" Style="{StaticResource FieldLabelStyle}" Margin="0"/>
                                <Button Style="{StaticResource MaterialDesignIconButton}"
                                        Command="{Binding DetectLocationCommand}"
                                        ToolTip="DÃ©tecter ma position"
                                        Width="20" Height="20"
                                        Margin="8,0,0,0">
                                    <materialDesign:PackIcon Kind="MapMarker" Width="16" Height="16"/>
                                </Button>
                            </StackPanel>
                            <TextBox Text="{Binding CompanyAddress, UpdateSourceTrigger=PropertyChanged}"
                                     materialDesign:HintAssist.Hint="Adresse complÃ¨te de l'entreprise"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                     MaxLength="200"
                                     AcceptsReturn="True"
                                     Height="100"
                                     TextWrapping="Wrap"
                                     VerticalScrollBarVisibility="Auto"/>
                        </StackPanel>
                        
                        <!-- Contact avec validation formatÃ©e -->
                        <Grid Margin="0,0,0,24">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="12"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- TÃ©lÃ©phone -->
                            <StackPanel Grid.Column="0">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="TÃ©lÃ©phone" Style="{StaticResource FieldLabelStyle}" Margin="0"/>
                                    <materialDesign:PackIcon Kind="Phone" 
                                                           Width="16" Height="16" 
                                                           Margin="8,0,0,0"
                                                           Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                </StackPanel>
                                <TextBox Text="{Binding CompanyPhone, UpdateSourceTrigger=PropertyChanged}"
                                         materialDesign:HintAssist.Hint="Ex: +225 01 02 03 04 05"
                                         Style="{StaticResource ValidatedTextBoxStyle}"
                                         MaxLength="20">
                                    <TextBox.InputBindings>
                                        <KeyBinding Key="Enter" Command="{Binding FormatPhoneCommand}"/>
                                    </TextBox.InputBindings>
                                </TextBox>
                            </StackPanel>
                            
                            <!-- Email -->
                            <StackPanel Grid.Column="2">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="Email" Style="{StaticResource FieldLabelStyle}" Margin="0"/>
                                    <materialDesign:PackIcon Kind="Email" 
                                                           Width="16" Height="16" 
                                                           Margin="8,0,0,0"
                                                           Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                </StackPanel>
                                <TextBox Text="{Binding CompanyEmail, UpdateSourceTrigger=PropertyChanged}"
                                         materialDesign:HintAssist.Hint="Ex: contact@entreprise.ci"
                                         Style="{StaticResource ValidatedTextBoxStyle}"
                                         MaxLength="100"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </materialDesign:Card>

                <!-- SÃ©parateur -->
                <GridSplitter Grid.Column="1" 
                            HorizontalAlignment="Stretch" 
                            Background="{DynamicResource MaterialDesignDivider}"/>

                <!-- Colonne Droite : Points de Vente et Actions -->
                <StackPanel Grid.Column="2">
                    <!-- Points de Vente avec fonctionnalitÃ©s avancÃ©es -->
                    <materialDesign:Card Style="{StaticResource InfoCardStyle}">
                        <StackPanel>
                            <Grid Margin="0,0,0,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <materialDesign:PackIcon Grid.Column="0"
                                                       Kind="Store" 
                                                       Width="24" Height="24"
                                                       VerticalAlignment="Center" 
                                                       Margin="0,0,12,0" 
                                                       Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                                
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="Points de Vente" 
                                             Style="{StaticResource SectionHeaderStyle}" 
                                             Margin="0"/>
                                    <TextBlock Style="{StaticResource MaterialDesignCaptionTextBlock}"
                                             Foreground="{DynamicResource MaterialDesignBodyLight}">
                                        <TextBlock.Text>
                                            <MultiBinding StringFormat="{}{0} point(s) configurÃ©(s)">
                                                <Binding Path="PointsOfSale.Count"/>
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </StackPanel>
                                
                                <!-- Templates de points de vente -->
                                <Button Grid.Column="2"
                                        Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Command="{Binding LoadTemplatesCommand}"
                                        ToolTip="Charger des modÃ¨les prÃ©dÃ©finis"
                                        Height="36"
                                        Margin="0,0,8,0">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="FileMultiple" 
                                                               Width="16" Height="16"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="Templates" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                
                                <Button Grid.Column="3"
                                        Style="{StaticResource AnimatedButtonStyle}"
                                        Command="{Binding AddPointOfSaleCommand}"
                                        ToolTip="Ajouter un nouveau point de vente"
                                        Height="36"
                                        Background="{DynamicResource SecondaryHueMidBrush}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Plus" 
                                                               Width="16" Height="16"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="Ajouter" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                            </Grid>

                            <!-- Liste des points de vente avec glisser-dÃ©poser -->
                            <ScrollViewer MaxHeight="300" VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding PointsOfSale}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <materialDesign:Card Style="{StaticResource SubCardStyle}"
                                                               Background="{DynamicResource MaterialDesignChipBackground}"
                                                               AllowDrop="True">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    
                                                    <!-- Handle pour drag & drop -->
                                                    <materialDesign:PackIcon Grid.Column="0"
                                                                           Kind="DragVertical" 
                                                                           Width="16" Height="16"
                                                                           VerticalAlignment="Center" 
                                                                           Margin="0,0,8,0" 
                                                                           Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                                           Cursor="SizeAll"/>
                                                    
                                                    <!-- IcÃ´ne du point de vente -->
                                                    <materialDesign:PackIcon Grid.Column="1"
                                                                           Kind="StorefrontOutline" 
                                                                           Width="20" Height="20"
                                                                           VerticalAlignment="Center" 
                                                                           Margin="0,0,12,0" 
                                                                           Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                                                    
                                                    <!-- Champs du point de vente -->
                                                    <StackPanel Grid.Column="2">
                                                        <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                                                 materialDesign:HintAssist.Hint="Nom du point de vente"
                                                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                                                 MaxLength="50"
                                                                 Margin="0,0,0,8"/>
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="8"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <TextBox Grid.Column="0"
                                                                     Text="{Binding Code, UpdateSourceTrigger=PropertyChanged}"
                                                                     materialDesign:HintAssist.Hint="Code (ex: 01, 02, Gestoci)"
                                                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                                                     MaxLength="10"
                                                                     FontFamily="Consolas"/>
                                                            <CheckBox Grid.Column="2"
                                                                      IsChecked="{Binding IsActive}"
                                                                      Content="Actif"
                                                                      VerticalAlignment="Center"/>
                                                        </Grid>
                                                    </StackPanel>
                                                    
                                                    <!-- Bouton duplicate -->
                                                    <Button Grid.Column="3"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            Command="{Binding DataContext.DuplicatePointOfSaleCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                            CommandParameter="{Binding}"
                                                            ToolTip="Dupliquer ce point de vente"
                                                            VerticalAlignment="Top"
                                                            Margin="4,0">
                                                        <materialDesign:PackIcon Kind="ContentDuplicate" 
                                                                               Width="18" Height="18"
                                                                               Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                                                    </Button>
                                                    
                                                    <!-- Bouton supprimer -->
                                                    <Button Grid.Column="4"
                                                            Style="{StaticResource MaterialDesignIconButton}"
                                                            Command="{Binding DataContext.RemovePointOfSaleCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                            CommandParameter="{Binding}"
                                                            ToolTip="Supprimer ce point de vente"
                                                            VerticalAlignment="Top"
                                                            Margin="4,0">
                                                        <materialDesign:PackIcon Kind="Delete" 
                                                                               Width="18" Height="18"
                                                                               Foreground="{DynamicResource ValidationErrorBrush}"/>
                                                    </Button>
                                                </Grid>
                                            </materialDesign:Card>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                            
                            <!-- Message si aucun point de vente avec actions rapides -->
                            <materialDesign:Card Style="{StaticResource SubCardStyle}"
                                               Background="{DynamicResource MaterialDesignDivider}"
                                               Opacity="0.7">
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <materialDesign:PackIcon Kind="StoreOff" 
                                                           Width="48" Height="48"
                                                           HorizontalAlignment="Center" 
                                                           Margin="0,0,0,12" 
                                                           Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    <TextBlock Text="Aucun point de vente configurÃ©"
                                             Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                             Foreground="{DynamicResource MaterialDesignBodyLight}"
                                             HorizontalAlignment="Center"
                                             FontWeight="Medium"/>
                                    <TextBlock Text="Cliquez sur 'Ajouter' ou 'Templates' pour commencer"
                                             Style="{StaticResource MaterialDesignBody2TextBlock}"
                                             Foreground="{DynamicResource MaterialDesignBodyLight}"
                                             HorizontalAlignment="Center"
                                             Margin="0,4,0,12"/>
                                    
                                    <!-- Actions rapides -->
                                    <StackPanel Orientation="Horizontal">
                                        <Button Content="ðŸ“„ SiÃ¨ge social"
                                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                                Command="{Binding AddHeadOfficeCommand}"
                                                Margin="0,0,8,0"/>
                                        <Button Content="ðŸª Magasin"
                                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                                Command="{Binding AddStoreCommand}"
                                                Margin="0,0,8,0"/>
                                        <Button Content="ðŸšš DÃ©pÃ´t"
                                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                                Command="{Binding AddWarehouseCommand}"/>
                                    </StackPanel>
                                </StackPanel>
                                <materialDesign:Card.Visibility>
                                    <Binding Path="HasPointsOfSale">
                                        <Binding.Converter>
                                            <BooleanToVisibilityConverter/>
                                        </Binding.Converter>
                                    </Binding>
                                </materialDesign:Card.Visibility>
                            </materialDesign:Card>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- Actions principales avec options avancÃ©es -->
                    <materialDesign:Card Style="{StaticResource InfoCardStyle}">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                <materialDesign:PackIcon Kind="ContentSave" 
                                                       Width="24" Height="24"
                                                       VerticalAlignment="Center" 
                                                       Margin="0,0,12,0" 
                                                       Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                                <TextBlock Text="Actions" 
                                         Style="{StaticResource SectionHeaderStyle}"
                                         Margin="0"/>
                            </StackPanel>
                            
                            <!-- Bouton principal de sauvegarde -->
                            <Button Style="{StaticResource AnimatedButtonStyle}"
                                    Command="{Binding SaveCommand}"
                                    IsEnabled="{Binding CanSave}"
                                    Height="56"
                                    HorizontalAlignment="Stretch"
                                    Margin="0,0,0,12"
                                    materialDesign:ButtonAssist.CornerRadius="8"
                                    Background="{DynamicResource PrimaryHueMidBrush}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="ContentSave" 
                                                           Width="24" Height="24"
                                                           VerticalAlignment="Center"
                                                           Margin="0,0,12,0"/>
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="Enregistrer la Configuration" 
                                                 VerticalAlignment="Center"
                                                 FontWeight="Medium"
                                                 FontSize="14"/>
                                        <TextBlock Text="Sauvegarder toutes les modifications"
                                                 FontSize="11"
                                                 Opacity="0.8"/>
                                    </StackPanel>
                                </StackPanel>
                            </Button>
                            
                            <!-- Actions secondaires -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="8"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <Button Grid.Column="0"
                                        Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Command="{Binding ExportConfigCommand}"
                                        Height="40">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Export" 
                                                               Width="16" Height="16"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="Exporter" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                
                                <Button Grid.Column="2"
                                        Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Command="{Binding ImportConfigCommand}"
                                        Height="40">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Import" 
                                                               Width="16" Height="16"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="Importer" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                            </Grid>
                            
                            <!-- Options avancÃ©es -->
                            <Expander Header="Options avancÃ©es" 
                                    Margin="0,16,0,0"
                                    materialDesign:ExpanderAssist.HorizontalHeaderPadding="0">
                                <StackPanel Margin="0,12,0,0">
                                    <CheckBox Content="Sauvegarde automatique lors des modifications"
                                              IsChecked="{Binding AutoSaveEnabled}"
                                              Margin="0,0,0,8"/>
                                    <CheckBox Content="Validation automatique du NCC"
                                              IsChecked="{Binding AutoValidateNcc}"
                                              Margin="0,0,0,8"/>
                                    <CheckBox Content="Synchroniser avec la base DGI"
                                              IsChecked="{Binding SyncWithDgi}"
                                              Margin="0,0,0,12"/>
                                    
                                    <Button Content="ðŸ”„ Synchroniser maintenant"
                                            Style="{StaticResource MaterialDesignOutlinedButton}"
                                            Command="{Binding SyncNowCommand}"
                                            HorizontalAlignment="Left"/>
                                </StackPanel>
                            </Expander>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- Informations importantes avec design interactif -->
                    <materialDesign:Card Style="{StaticResource InfoCardStyle}"
                                       Background="{DynamicResource MaterialDesignCardBackground}">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                <materialDesign:PackIcon Kind="InformationVariant" 
                                                       Width="24" Height="24"
                                                       VerticalAlignment="Center" 
                                                       Margin="0,0,12,0"
                                                       Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                                <TextBlock Text="Guide &amp; Assistance" 
                                         Style="{StaticResource SectionHeaderStyle}"
                                         Margin="0"/>
                            </StackPanel>
                            
                            <!-- Informations avec expand/collapse -->
                            <StackPanel>
                                <Expander Header="ðŸŸ¢ Certification FNE" 
                                        IsExpanded="True"
                                        Margin="0,0,0,8">
                                    <StackPanel Margin="24,8,0,0">
                                        <TextBlock Text="Le NCC entreprise est obligatoire pour la certification FNE"
                                                 TextWrapping="Wrap"
                                                 Style="{StaticResource MaterialDesignBody2TextBlock}"
                                                 Margin="0,0,0,8"/>
                                        <Button Content="ðŸ“– Guide de certification"
                                                Style="{StaticResource MaterialDesignFlatButton}"
                                                HorizontalAlignment="Left"
                                                Command="{Binding OpenCertificationGuideCommand}"/>
                                    </StackPanel>
                                </Expander>
                                
                                <Expander Header="ðŸ”µ Facturation Ã‰lectronique" 
                                        Margin="0,0,0,8">
                                    <StackPanel Margin="24,8,0,0">
                                        <TextBlock Text="Ces informations seront utilisÃ©es pour toutes les factures certifiÃ©es"
                                                 TextWrapping="Wrap"
                                                 Style="{StaticResource MaterialDesignBody2TextBlock}"
                                                 Margin="0,0,0,8"/>
                                        <Button Content="âš¡ Tester la facturation"
                                                Style="{StaticResource MaterialDesignFlatButton}"
                                                HorizontalAlignment="Left"
                                                Command="{Binding TestInvoicingCommand}"/>
                                    </StackPanel>
                                </Expander>
                                
                                <Expander Header="ðŸŸ  IntÃ©gration Sage 100" 
                                        Margin="0,0,0,8">
                                    <StackPanel Margin="24,8,0,0">
                                        <TextBlock Text="Les points de vente doivent correspondre Ã  ceux de votre fichier Excel Sage 100"
                                                 TextWrapping="Wrap"
                                                 Style="{StaticResource MaterialDesignBody2TextBlock}"
                                                 Margin="0,0,0,8"/>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Content="ðŸ“Š Importer de Sage"
                                                    Style="{StaticResource MaterialDesignFlatButton}"
                                                    Command="{Binding ImportFromSageCommand}"
                                                    Margin="0,0,8,0"/>
                                            <Button Content="ðŸ” VÃ©rifier correspondance"
                                                    Style="{StaticResource MaterialDesignFlatButton}"
                                                    Command="{Binding VerifyMappingCommand}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Expander>
                                
                                <!-- Section d'aide contextuelle -->
                                <Border Background="{DynamicResource PrimaryHueLightBrush}"
                                        CornerRadius="8"
                                        Padding="16"
                                        Margin="0,12,0,0">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <materialDesign:PackIcon Kind="HelpCircle" 
                                                                   Width="20" Height="20"
                                                                   Foreground="White"
                                                                   VerticalAlignment="Center"
                                                                   Margin="0,0,8,0"/>
                                            <TextBlock Text="Besoin d'aide ?" 
                                                     Foreground="White"
                                                     FontWeight="Medium"
                                                     VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Content="ðŸ“ž Support technique"
                                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                                    Foreground="White"
                                                    BorderBrush="White"
                                                    Command="{Binding ContactSupportCommand}"
                                                    Margin="0,0,8,0"/>
                                            <Button Content="ðŸ“š Documentation"
                                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                                    Foreground="White"
                                                    BorderBrush="White"
                                                    Command="{Binding OpenDocumentationCommand}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                    </materialDesign:Card>
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>
