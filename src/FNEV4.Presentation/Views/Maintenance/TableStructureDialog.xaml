<Window x:Class="FNEV4.Presentation.Views.Maintenance.TableStructureDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Structure de la Table"
        Height="500" Width="800"
        WindowStartupLocation="CenterOwner"
        Style="{StaticResource MaterialDesignWindow}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- En-tête -->
        <materialDesign:Card Grid.Row="0" Margin="16,16,16,8">
            <Grid Margin="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <materialDesign:PackIcon Grid.Column="0" 
                                       Kind="FileTree" 
                                       Width="24" Height="24"
                                       VerticalAlignment="Center"
                                       Margin="0,0,12,0"/>

                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="{Binding TableName, StringFormat='Structure de la table : \{0\}'}"
                              Style="{StaticResource MaterialDesignHeadline6TextBlock}"/>
                    <TextBlock Text="{Binding ColumnCount, StringFormat='\{0\} colonnes définies'}"
                              Style="{StaticResource MaterialDesignCaptionTextBlock}"
                              Opacity="0.7"/>
                </StackPanel>

                <Button Grid.Column="2"
                       Style="{StaticResource MaterialDesignIconButton}"
                       ToolTip="Générer le script CREATE TABLE"
                       Command="{Binding GenerateCreateScriptCommand}">
                    <materialDesign:PackIcon Kind="CodeTags"/>
                </Button>
            </Grid>
        </materialDesign:Card>

        <!-- Contenu principal -->
        <materialDesign:Card Grid.Row="1" Margin="16,0,16,8">
            <TabControl Margin="16" Style="{StaticResource MaterialDesignTabControl}">
                
                <!-- Onglet Colonnes -->
                <TabItem Header="Colonnes">
                    <Grid Margin="0,16,0,0">
                        <DataGrid ItemsSource="{Binding Columns}"
                                 AutoGenerateColumns="False"
                                 CanUserAddRows="False"
                                 CanUserDeleteRows="False"
                                 IsReadOnly="True"
                                 materialDesign:DataGridAssist.CellPadding="8"
                                 materialDesign:DataGridAssist.ColumnHeaderPadding="8">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Nom" 
                                                   Binding="{Binding Name}" 
                                                   Width="150"/>
                                <DataGridTextColumn Header="Type" 
                                                   Binding="{Binding DataType}" 
                                                   Width="120"/>
                                <DataGridCheckBoxColumn Header="Null" 
                                                       Binding="{Binding IsNullable}" 
                                                       Width="60"/>
                                <DataGridCheckBoxColumn Header="Clé primaire" 
                                                       Binding="{Binding IsPrimaryKey}" 
                                                       Width="100"/>
                                <DataGridTextColumn Header="Valeur par défaut" 
                                                   Binding="{Binding DefaultValue}" 
                                                   Width="150"/>
                                <DataGridTextColumn Header="Description" 
                                                   Binding="{Binding Description}" 
                                                   Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>

                <!-- Onglet Index -->
                <TabItem Header="Index">
                    <Grid Margin="0,16,0,0">
                        <DataGrid ItemsSource="{Binding Indexes}"
                                 AutoGenerateColumns="False"
                                 CanUserAddRows="False"
                                 CanUserDeleteRows="False"
                                 IsReadOnly="True"
                                 materialDesign:DataGridAssist.CellPadding="8"
                                 materialDesign:DataGridAssist.ColumnHeaderPadding="8">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Nom" 
                                                   Binding="{Binding Name}" 
                                                   Width="200"/>
                                <DataGridCheckBoxColumn Header="Unique" 
                                                       Binding="{Binding IsUnique}" 
                                                       Width="80"/>
                                <DataGridTextColumn Header="Colonnes" 
                                                   Binding="{Binding Columns}" 
                                                   Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>

                <!-- Onglet Contraintes -->
                <TabItem Header="Contraintes">
                    <Grid Margin="0,16,0,0">
                        <DataGrid ItemsSource="{Binding Constraints}"
                                 AutoGenerateColumns="False"
                                 CanUserAddRows="False"
                                 CanUserDeleteRows="False"
                                 IsReadOnly="True"
                                 materialDesign:DataGridAssist.CellPadding="8"
                                 materialDesign:DataGridAssist.ColumnHeaderPadding="8">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Nom" 
                                                   Binding="{Binding Name}" 
                                                   Width="200"/>
                                <DataGridTextColumn Header="Type" 
                                                   Binding="{Binding Type}" 
                                                   Width="120"/>
                                <DataGridTextColumn Header="Définition" 
                                                   Binding="{Binding Definition}" 
                                                   Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>

                <!-- Onglet SQL -->
                <TabItem Header="Script SQL">
                    <Grid Margin="0,16,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" 
                                  Text="Script CREATE TABLE généré :"
                                  Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                                  Margin="0,0,0,8"/>

                        <TextBox Grid.Row="1"
                                Text="{Binding CreateTableScript}"
                                IsReadOnly="True"
                                AcceptsReturn="True"
                                TextWrapping="Wrap"
                                VerticalScrollBarVisibility="Auto"
                                FontFamily="Consolas"
                                FontSize="12"
                                Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                    </Grid>
                </TabItem>
            </TabControl>
        </materialDesign:Card>

        <!-- Actions -->
        <materialDesign:Card Grid.Row="2" Margin="16,0,16,16">
            <StackPanel Orientation="Horizontal" 
                       HorizontalAlignment="Right" 
                       Margin="16">
                <Button Content="Copier SQL"
                       Style="{StaticResource MaterialDesignOutlinedButton}"
                       Command="{Binding CopySqlCommand}"
                       Margin="0,0,8,0"/>
                <Button Content="Fermer"
                       Style="{StaticResource MaterialDesignOutlinedButton}"
                       IsCancel="True"
                       Click="CloseButton_Click"/>
            </StackPanel>
        </materialDesign:Card>
    </Grid>
</Window>
