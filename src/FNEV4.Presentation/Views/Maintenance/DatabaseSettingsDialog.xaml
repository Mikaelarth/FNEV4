<Window x:Class="FNEV4.Presentation.Views.Maintenance.DatabaseSettingsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Paramètres de la Base de Données"
        Height="600" Width="800"
        ResizeMode="CanResize"
        WindowStartupLocation="CenterOwner"
        Style="{StaticResource MaterialDesignWindow}">

    <Window.Resources>
        <Style TargetType="GroupBox" BasedOn="{StaticResource MaterialDesignCardGroupBox}">
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="16"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- En-tête -->
        <materialDesign:Card Grid.Row="0" Margin="8,8,8,0">
            <StackPanel>
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Settings" 
                                           VerticalAlignment="Center" 
                                           Width="24" Height="24"
                                           Margin="0,0,12,0"/>
                    <TextBlock Text="Configuration de la Base de Données" 
                              Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                              VerticalAlignment="Center"/>
                </StackPanel>
                <TextBlock Text="Configurez les paramètres de connexion, sauvegarde et optimisation" 
                          Style="{StaticResource MaterialDesignCaptionTextBlock}" 
                          Opacity="0.7"
                          Margin="36,4,0,0"/>
            </StackPanel>
        </materialDesign:Card>

        <!-- Contenu principal avec TabControl -->
        <TabControl Grid.Row="1" Margin="8" Style="{StaticResource MaterialDesignTabControl}">
            
            <!-- Onglet Connexion -->
            <TabItem Header="Connexion">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        
                        <GroupBox Header="Configuration de la connexion">
                            <StackPanel>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBox Grid.Column="0"
                                            materialDesign:HintAssist.Hint="Chemin de la base de données"
                                            Text="{Binding DatabasePath}"
                                            Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                            Margin="0,0,8,0"/>
                                    
                                    <Button Grid.Column="1"
                                           Content="Parcourir..."
                                           Style="{StaticResource MaterialDesignOutlinedButton}"
                                           Command="{Binding BrowseDatabasePathCommand}"
                                           VerticalAlignment="Bottom"
                                           Height="40"
                                           Margin="0,0,4,0"/>
                                    
                                    <Button Grid.Column="2"
                                           Content="Défaut"
                                           Style="{StaticResource MaterialDesignOutlinedButton}"
                                           Command="{Binding ResetDatabasePathCommand}"
                                           VerticalAlignment="Bottom"
                                           Height="40"/>
                                </Grid>
                                
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBox Grid.Column="0"
                                            materialDesign:HintAssist.Hint="Timeout de connexion (sec)"
                                            Text="{Binding ConnectionTimeout}"
                                            Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                            Margin="0,0,4,0"/>
                                    
                                    <TextBox Grid.Column="1"
                                            materialDesign:HintAssist.Hint="Taille du cache (KB)"
                                            Text="{Binding CacheSize}"
                                            Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                            Margin="4,0,0,0"/>
                                </Grid>
                                
                                <CheckBox Content="Mode WAL (Write-Ahead Logging)"
                                         IsChecked="{Binding EnableWalMode}"
                                         Margin="0,16,0,8"/>
                                
                                <CheckBox Content="Auto-vacuum activé"
                                         IsChecked="{Binding EnableAutoVacuum}"
                                         Margin="0,8"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Options de performance">
                            <StackPanel>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Column="0" Text="Page Size :" VerticalAlignment="Center" Width="100"/>
                                    <Slider Grid.Column="1" 
                                           Value="{Binding PageSize}" 
                                           Minimum="512" Maximum="65536" 
                                           TickFrequency="512"
                                           Margin="8,0"/>
                                    <TextBlock Grid.Column="2" 
                                              Text="{Binding PageSize, StringFormat={}{0} bytes}" 
                                              VerticalAlignment="Center" Width="80"/>
                                </Grid>
                                
                                <CheckBox Content="Synchronisation forcée après chaque écriture"
                                         IsChecked="{Binding ForceSynchronous}"
                                         Margin="0,8"/>
                            </StackPanel>
                        </GroupBox>
                        
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Onglet Sauvegarde -->
            <TabItem Header="Sauvegarde">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        
                        <GroupBox Header="Sauvegarde automatique">
                            <StackPanel>
                                <CheckBox Content="Activer la sauvegarde automatique"
                                         IsChecked="{Binding AutoBackupEnabled}"
                                         Margin="0,8"/>
                                
                                <ComboBox materialDesign:HintAssist.Hint="Fréquence"
                                         SelectedValue="{Binding BackupFrequency}"
                                         Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                         Margin="0,8">
                                    <ComboBoxItem Content="Quotidienne" Tag="Daily"/>
                                    <ComboBoxItem Content="Hebdomadaire" Tag="Weekly"/>
                                    <ComboBoxItem Content="Mensuelle" Tag="Monthly"/>
                                </ComboBox>
                                
                                <materialDesign:TimePicker materialDesign:HintAssist.Hint="Heure de sauvegarde"
                                                          SelectedTime="{Binding BackupTime}"
                                                          Style="{StaticResource MaterialDesignOutlinedTimePicker}"
                                                          Margin="0,8"/>
                                
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBox Grid.Column="0"
                                            materialDesign:HintAssist.Hint="Répertoire de sauvegarde"
                                            Text="{Binding BackupDirectory}"
                                            Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                            Margin="0,0,8,0"/>
                                    
                                    <Button Grid.Column="1"
                                           Content="Parcourir..."
                                           Style="{StaticResource MaterialDesignOutlinedButton}"
                                           Command="{Binding BrowseBackupDirectoryCommand}"
                                           VerticalAlignment="Bottom"
                                           Height="40"/>
                                </Grid>
                                
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Column="0" Text="Rétention :" VerticalAlignment="Center" Width="100"/>
                                    <Slider Grid.Column="1" 
                                           Value="{Binding BackupRetentionDays}" 
                                           Minimum="1" Maximum="365" 
                                           TickFrequency="7"
                                           Margin="8,0"/>
                                    <TextBlock Grid.Column="2" 
                                              Text="{Binding BackupRetentionDays, StringFormat={}{0} jours}" 
                                              VerticalAlignment="Center" Width="80"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Compression">
                            <StackPanel>
                                <CheckBox Content="Compresser les sauvegardes"
                                         IsChecked="{Binding CompressBackups}"
                                         Margin="0,8"/>
                                
                                <ComboBox materialDesign:HintAssist.Hint="Niveau de compression"
                                         SelectedValue="{Binding CompressionLevel}"
                                         Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                         IsEnabled="{Binding CompressBackups}"
                                         Margin="0,8">
                                    <ComboBoxItem Content="Rapide" Tag="Fast"/>
                                    <ComboBoxItem Content="Normal" Tag="Normal"/>
                                    <ComboBoxItem Content="Maximum" Tag="Maximum"/>
                                </ComboBox>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Test de sauvegarde">
                            <StackPanel>
                                <TextBlock Text="Testez la configuration de sauvegarde automatique" 
                                          Style="{StaticResource MaterialDesignCaptionTextBlock}" 
                                          Opacity="0.7"
                                          Margin="0,0,0,8"/>
                                
                                <Button Content="Créer une sauvegarde de test"
                                       Style="{StaticResource MaterialDesignOutlinedButton}"
                                       Command="{Binding TestBackupCommand}"
                                       Margin="0,8"/>
                            </StackPanel>
                        </GroupBox>
                        
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Onglet Alertes -->
            <TabItem Header="Alertes">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        
                        <GroupBox Header="Seuils d'alerte">
                            <StackPanel>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Column="0" Text="Taille max (MB) :" VerticalAlignment="Center" Width="120"/>
                                    <Slider Grid.Column="1" 
                                           Value="{Binding MaxDatabaseSizeMB}" 
                                           Minimum="10" Maximum="10000" 
                                           TickFrequency="100"
                                           Margin="8,0"/>
                                    <TextBlock Grid.Column="2" 
                                              Text="{Binding MaxDatabaseSizeMB, StringFormat={}{0} MB}" 
                                              VerticalAlignment="Center" Width="80"/>
                                </Grid>
                                
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Column="0" Text="Nb tables max :" VerticalAlignment="Center" Width="120"/>
                                    <Slider Grid.Column="1" 
                                           Value="{Binding MaxTableCount}" 
                                           Minimum="5" Maximum="500" 
                                           TickFrequency="10"
                                           Margin="8,0"/>
                                    <TextBlock Grid.Column="2" 
                                              Text="{Binding MaxTableCount, StringFormat={}{0} tables}" 
                                              VerticalAlignment="Center" Width="80"/>
                                </Grid>
                                
                                <CheckBox Content="Alertes par email"
                                         IsChecked="{Binding EmailAlertsEnabled}"
                                         Margin="0,16,0,8"/>
                                
                                <TextBox materialDesign:HintAssist.Hint="Adresse email pour les alertes"
                                        Text="{Binding AlertEmailAddress}"
                                        IsEnabled="{Binding EmailAlertsEnabled}"
                                        Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                        Margin="0,8"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Test de surveillance">
                            <StackPanel>
                                <TextBlock Text="Testez le système d'alertes et de surveillance en temps réel" 
                                          Style="{StaticResource MaterialDesignCaptionTextBlock}" 
                                          Opacity="0.7"
                                          Margin="0,0,0,8"/>
                                
                                <Button Content="Tester la configuration des alertes"
                                       Style="{StaticResource MaterialDesignOutlinedButton}"
                                       Command="{Binding TestAlertsCommand}"
                                       Margin="0,8"/>
                                
                                <Button Content="Vérifier les seuils maintenant"
                                       Style="{StaticResource MaterialDesignRaisedButton}"
                                       Command="{Binding CheckAlertsNowCommand}"
                                       Margin="0,8"/>
                            </StackPanel>
                        </GroupBox>
                        
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Onglet Affichage -->
            <TabItem Header="Affichage">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        
                        <GroupBox Header="Formats d'affichage">
                            <StackPanel>
                                <ComboBox materialDesign:HintAssist.Hint="Format des dates"
                                         SelectedValue="{Binding DateFormat}"
                                         Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                         Margin="0,8">
                                    <ComboBoxItem Content="dd/MM/yyyy HH:mm" Tag="dd/MM/yyyy HH:mm"/>
                                    <ComboBoxItem Content="yyyy-MM-dd HH:mm:ss" Tag="yyyy-MM-dd HH:mm:ss"/>
                                    <ComboBoxItem Content="dd/MM/yyyy" Tag="dd/MM/yyyy"/>
                                    <ComboBoxItem Content="yyyy-MM-dd" Tag="yyyy-MM-dd"/>
                                </ComboBox>
                                
                                <ComboBox materialDesign:HintAssist.Hint="Unité de taille"
                                         SelectedValue="{Binding SizeUnit}"
                                         Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                         Margin="0,8">
                                    <ComboBoxItem Content="Bytes" Tag="Bytes"/>
                                    <ComboBoxItem Content="KB" Tag="KB"/>
                                    <ComboBoxItem Content="MB" Tag="MB"/>
                                    <ComboBoxItem Content="Auto" Tag="Auto"/>
                                </ComboBox>
                                
                                <CheckBox Content="Afficher les millisecondes dans les timestamps"
                                         IsChecked="{Binding ShowMilliseconds}"
                                         Margin="0,16,0,8"/>
                                
                                <CheckBox Content="Actualisation automatique toutes les 30 secondes"
                                         IsChecked="{Binding AutoRefreshEnabled}"
                                         Margin="0,8"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Aperçu et test des formats">
                            <StackPanel>
                                <TextBlock Text="Testez les formats d'affichage avec des exemples en temps réel" 
                                          Style="{StaticResource MaterialDesignCaptionTextBlock}" 
                                          Opacity="0.7"
                                          Margin="0,0,0,8"/>
                                
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Column="0" Text="Date actuelle :" VerticalAlignment="Center" Width="120" FontWeight="Medium"/>
                                    <TextBlock Grid.Column="1" 
                                              Text="{Binding CurrentDatePreview}" 
                                              VerticalAlignment="Center" 
                                              FontFamily="Consolas"
                                              Background="{DynamicResource MaterialDesignTextFieldBoxBackground}"
                                              Padding="8,4"/>
                                </Grid>
                                
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Column="0" Text="Taille exemple :" VerticalAlignment="Center" Width="120" FontWeight="Medium"/>
                                    <TextBlock Grid.Column="1" 
                                              Text="{Binding SizePreview}" 
                                              VerticalAlignment="Center" 
                                              FontFamily="Consolas"
                                              Background="{DynamicResource MaterialDesignTextFieldBoxBackground}"
                                              Padding="8,4"/>
                                </Grid>
                                
                                <Button Content="Actualiser l'aperçu"
                                       Style="{StaticResource MaterialDesignOutlinedButton}"
                                       Command="{Binding RefreshPreviewCommand}"
                                       Margin="0,8"/>
                                
                                <Button Content="Tester l'actualisation automatique"
                                       Style="{StaticResource MaterialDesignRaisedButton}"
                                       Command="{Binding TestAutoRefreshCommand}"
                                       Margin="0,8"/>
                            </StackPanel>
                        </GroupBox>
                        
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

        </TabControl>

        <!-- Boutons d'action -->
        <Border Grid.Row="2" Background="{DynamicResource MaterialDesignPaper}" BorderThickness="0,1,0,0" BorderBrush="{DynamicResource MaterialDesignDivider}">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="16">
                <Button Content="Tester la connexion"
                       Style="{StaticResource MaterialDesignOutlinedButton}"
                       Command="{Binding TestConnectionCommand}"
                       Margin="0,0,8,0"/>
                
                <Button Content="Réinitialiser"
                       Style="{StaticResource MaterialDesignOutlinedButton}"
                       Command="{Binding ResetSettingsCommand}"
                       Margin="0,0,8,0"/>
                
                <Button Content="Annuler"
                       Style="{StaticResource MaterialDesignOutlinedButton}"
                       Command="{Binding CancelCommand}"
                       Margin="0,0,8,0"/>
                
                <Button Content="Appliquer"
                       Style="{StaticResource MaterialDesignRaisedButton}"
                       Command="{Binding ApplySettingsCommand}"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
